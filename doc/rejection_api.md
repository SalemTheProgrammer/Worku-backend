# Rejection API Documentation

## Overview

The Rejection API allows recruiters to reject job applications with personalized messages generated by Gemini AI. When a candidate is rejected, they receive a personalized email explaining why they weren't selected, and their profile is updated to track the rejection history.

## Base URL

```
/rejections
```

## Authentication

All endpoints (except for getting rejection reasons) require a valid JWT token to be included in the Authorization header:

```
Authorization: Bearer YOUR_JWT_TOKEN
```

## Endpoints

### 1. Reject Application

Rejects an application and sends a personalized rejection email to the candidate.

**Endpoint:** `POST /rejections`

**Authentication:** Required (JWT)

**Request Body:**

```json
{
  "applicationId": "60d21b4667d0d8992e610c85",
  "reason": "competences_insuffisantes",
  "notes": "Le candidat manque d'expérience avec React et Node.js"
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| applicationId | string | Yes | ID of the application to reject |
| reason | string | Yes | Rejection reason ID (from rejection reasons list) |
| notes | string | No | Additional notes about the rejection (required for "autre" reason) |

**Response:**

```json
{
  "success": true,
  "message": "La candidature a été rejetée et le candidat a été notifié"
}
```

**Status Codes:**

- `200 OK` - Request successful
- `400 Bad Request` - Invalid input data
- `401 Unauthorized` - Authentication failed
- `404 Not Found` - Application not found
- `500 Internal Server Error` - Server error

### 2. Get Rejection Reasons

Returns a list of available rejection reasons.

**Endpoint:** `GET /rejections/reasons`

**Authentication:** Not required

**Response:**

```json
[
  {
    "id": "profil_inadequat",
    "label": "Profil ne correspond pas aux exigences du poste"
  },
  {
    "id": "manque_experience",
    "label": "Manque d'expérience pertinente"
  },
  {
    "id": "competences_insuffisantes",
    "label": "Compétences techniques insuffisantes"
  },
  {
    "id": "attentes_salariales",
    "label": "Attentes salariales trop élevées"
  },
  {
    "id": "inadequation_culturelle",
    "label": "Inadéquation culturelle avec l'entreprise"
  },
  {
    "id": "candidature_incomplete",
    "label": "Candidature incomplète ou mal présentée"
  },
  {
    "id": "meilleur_candidat_selectionne",
    "label": "Meilleur candidat sélectionné"
  },
  {
    "id": "poste_pourvu_annule",
    "label": "Poste pourvu / annulé"
  },
  {
    "id": "non_reponse_candidat",
    "label": "Non réponse du candidat après contact"
  },
  {
    "id": "autre",
    "label": "Autre (à préciser dans les notes)"
  }
]
```

**Status Codes:**

- `200 OK` - Request successful
- `500 Internal Server Error` - Server error

## Rejection Process

When an application is rejected:

1. The system retrieves detailed information about the application, candidate, and job
2. Gemini AI generates a personalized rejection message based on:
   - The candidate's profile and skills
   - The job requirements
   - The selected rejection reason
   - Any additional notes provided by the recruiter
3. A personalized email is sent to the candidate
4. The application status is updated to "rejeté"
5. The application ID is added to the candidate's rejectedApplications list

## Error Responses

In case of an error, the API returns a response with an error message:

```json
{
  "statusCode": 400,
  "message": "Invalid rejection reason",
  "error": "Bad Request"
}
```

## Examples

### Example 1: Rejecting an application due to insufficient skills

**Request:**

```http
POST /rejections HTTP/1.1
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "applicationId": "60d21b4667d0d8992e610c85",
  "reason": "competences_insuffisantes",
  "notes": "Le candidat manque d'expérience avec les frameworks modernes comme React et Angular."
}
```

**Response:**

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "success": true,
  "message": "La candidature a été rejetée et le candidat a été notifié"
}
```

### Example 2: Getting rejection reasons

**Request:**

```http
GET /rejections/reasons HTTP/1.1
```

**Response:**

```http
HTTP/1.1 200 OK
Content-Type: application/json

[
  {
    "id": "profil_inadequat",
    "label": "Profil ne correspond pas aux exigences du poste"
  },
  // ... other reasons
]
```

## Notes

- The rejection email is personalized based on the candidate's profile and the job requirements
- The rejection reason and notes are used to generate a more specific and helpful message
- The system keeps track of rejected applications for both recruiters and candidates
- When using the "autre" reason, providing detailed notes is recommended for better personalization